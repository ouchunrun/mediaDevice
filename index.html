<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="src/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="src/mediaDevice.js"></script>
    <title>可用设备检查</title>
</head>
<body>

<div class="col-sm">
    <div class="input-group input-group-sm mb-3">
        <div class="input-group-prepend">
            <label class="input-group-text" for="audioList"><strong class="text-gray-dark">音频设备</strong></label>
        </div>
        <select class="custom-select" id="audioList" style="width: 60%">
        </select>
    </div>
</div>

<div class="col-sm">
    <div class="input-group input-group-sm mb-3">
        <div class="input-group-prepend">
            <label class="input-group-text" for="videoList"><strong class="text-gray-dark">视频设备</strong></label>
        </div>
        <select class="custom-select" id="videoList" style="width: 60%">
        </select>
    </div>
</div>

<script>
  /***
   * 获取设备
   */
  var mediaDevice = new MediaDevice()
  function getEnumDevices() {
    var audioInputList = []
    var videoInputList = []
    mediaDevice.enumDevices(deviceInfo => {
      console.log('enumDevices' + JSON.stringify(deviceInfo))
      if (deviceInfo.microphones) {
        for (var i = 0; i < deviceInfo.microphones.length; i++) {
          if (!deviceInfo.microphones[i].label) {
            deviceInfo.microphones[i].label = 'microphone' + i
          }
          audioInputList.push(' <option value="' + deviceInfo.microphones[i].deviceId + '">' + deviceInfo.microphones[i].label + '</option>')
          console.log('microphone: ' + deviceInfo.microphones[i].label)
        }
      }

      if (deviceInfo.cameras) {
        for (var j = 0; j < deviceInfo.cameras.length; j++) {
          if (!deviceInfo.cameras[j].label) {
            deviceInfo.cameras[j].label = 'camera' + j
          }
          videoInputList.push('<option value="' + deviceInfo.cameras[j].deviceId + '">' + deviceInfo.cameras[j].label + '</option>')
          console.log('camera: ' + deviceInfo.cameras[j].label)
        }
      }

      audioInputList.push(' <option value="0">禁止</option>')
      videoInputList.push('<option value="0">禁止</option>')
      $('#audioList').html(audioInputList.join(''));
      $('#videoList').html(videoInputList.join(''));

    }, function (error) {
      console.error('enum device error: ' + error)
    })
  }
  getEnumDevices()
  mediaDevice.checkAvailableDev()
  // mediaDevice.setDeviceCapability()
  // mediaDevice.setDeviceCheckInterval(true)


  var expectRes = {
    deviceId: '4b5305afd805f2d8439eac80dc94b14846799929d44d18c7dd8fc97eda75c046',
    width: 1280,
    height: 720,
    frameRate: 15,
  }
  setTimeout(function () {
    mediaDevice.getSuitableResolution(expectRes)
  }, 3000)
</script>
</body>
</html>